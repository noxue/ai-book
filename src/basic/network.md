# 计算机网络基础

建议先看 [数据存储通识](./storage.md)，了解数据在电脑中是如何表示的。

本文面向零基础外行人，长话短说，有个大致理解。

## 基础概念

把多个电脑连接起来，就构成了网络。 

我们在谍战片中应该看到过用手打摩斯密码的场景。 摩斯密码就是一种规则，双方都理解这个规则，就能互相通信。

计算机之间要能互相通信，也需要定一种规则。

## 网络模型

目前最常用的网络模型是 TCP/IP 模型。此外还有 OSI 模型（更多的用于教学和理论分析）。

模型名字不重要，只是人为取的名字，和张三李四没区别。不必因此有心理负担。

网络非常复杂，涉及到从硬件到软件的方方面面。

要让复杂的东西变简单，只需要分模块，让每个模块负责一个功能。模块之间互相不需要了解细节。

其实生活中也有很多这样的例子。

很多设计思维都是从生活中来的，下次遇到想不通的，不妨从生活中寻找思路。

比如公司分多个部门，每个部门负责一部分事情：

- 销售部：负责销售
- 技术部：负责研发

销售只要负责销售，技术部只要负责研发，互相不需要了解对方的工作的细节。


TCP/IP 模型分为四层（有个印象就行，不要有心理负担）：

- 应用层：负责处理 HTTP, SMTP, FTP 等协议
- 传输层：负责处理 TCP, UDP 协议
- 网络层：负责处理 IP, ICMP 等协议
- 链路层：负责处理以太网协议

核心就是每一层只需要理解自己负责的协议，不需要了解其他层的协议。

> 扩展知识，可以不看：
> 
> 协议不是什么高深的东西，就是规则而已，是死的，规定好的
> 
> 规定了数据应该用什么格式发送和处理，每个数字代表什么含义
> 
> 在 https://www.rfc-editor.org/ 可以找到很多协议的文档
>
> 比如 TCP 协议的文档地址：https://www.rfc-editor.org/rfc/rfc9293.txt
>
> 每个协议都有一个编号，比如 TCP 的编号是 RFC 9293


## 网络中常见的概念

### IP地址

IP 地址(通常指 IPv4 地址)是网络中每个设备的唯一标识。 

其本质就是一个数字编号，一共 32 位，4个字节大小，正好一个字节8位，用十进制表示，范围是 0-255。

为了方便记忆，通常用点分十进制表示法，比如 `192.168.1.1`，正好每一段对应 1 个字节。

随着电脑手机的数量越来越多，ipv4 地址不够用，于是产生了局域网，划分了几段地址专门用于局域网。这样一堆设备共享一个外网ip地址，暂时缓解了地址不够用的问题。

最新的解决方法是使用 ipv6 地址，128 位，16 个字节，用十六进制表示，比如 `2001:0db8:85a3:0000:0000:8a2e:0370:7334`。

理论上，ipv6 地址可以容纳 2^128 = 340282366920938463463374607431768211456 个设备，这个数量级已经远远超过地球上沙粒的数量。 

### 端口

端口是用来区分同一个ip地址下不同的程序。

电脑中每个程序和外部通信时，都需要占用一个端口。

当电脑收到一个数据包时，会根据数据包中的端口号，将数据包转发给对应的程序。

端口是一个 16 位（2个字节）的数字，范围是 0-65535。

端口号之所以是2字节，其实就是因为 tcp、udp 协议中规定的。

### 域名

域名是为了方便人们记忆而产生的，当人们输入一个域名时，浏览器会根据域名去 DNS 服务器查询对应的 IP 地址。

DNS 服务器叫做 域名服务器，是用来存储域名和 IP 地址的对应关系的。 可以理解为 网上有一台电脑专门保存了域名和 IP 地址的对应关系。

### TCP 和 UDP

TCP 和 UDP 是传输层协议，负责处理数据包的传输。

TCP 是面向连接的，可靠的协议，保证数据包按顺序到达。

UDP 是面向无连接的，不可靠的协议，不保证数据包按顺序到达。


* 下面是 TCP 和 UDP 的对比（看不懂的无所谓）：

| 对比项 | TCP | UDP |
|--------|-----|-----|
| 连接方式 | 面向连接 | 无连接 |
| 可靠性 | 可靠传输 | 不可靠传输 |
| 传输顺序 | 保证顺序 | 不保证顺序 |
| 传输速度 | 相对较慢 | 相对较快 |
| 资源消耗 | 较多 | 较少 |
| 应用场景 | 网页浏览、文件传输、邮件等 | 视频直播、游戏、DNS查询等 |
| 连接建立 | 三次握手 | 无需建立连接 |
| 连接断开 | 四次挥手 | 无需断开连接 |

TCP 需要先建立连接，但是能保证数据包按顺序到达。UDP 不需要建立连接速度快，但是不能保证数据包按顺序到达。


* 一张骚气的图加深印象
  
![TCP UDP](./images/network-03.png)

> 扩展知识，可以不看：
>
> TCP 之所以相对较慢，就是因为他要保证发送的顺序和完整性。
> 
> 比如：丢包了要重发，这就造成了重复发送和延迟，还有收到数据还要发送确认包通知对方我收到了。并且 TCP 头至少有 20 字节，比 UDP 头 8 字节大，意味着每个包要多传输额外的数据。所以速度慢。
>
> UDP 只管发送，丢包也不会重新发送。所以速度快。
>
> 但是 UDP 可以从应用层去通过算法保证可靠性。最新的 HTTP/3 协议就是基于 UDP 的。 


# 下面属于进阶部分，有兴趣可以看，不看也行

## 通过 TCP协议 发送一个字符，演示数据的传输过程

https://datatracker.ietf.org/doc/html/rfc9293#name-header-format


## 一个网页请求的过程来展示 TCP/IP 模型是如何工作的





